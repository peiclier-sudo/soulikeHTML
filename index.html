<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="description" content="ORDALIE - A dark action web game built with Three.js">
    <meta name="theme-color" content="#06080c">
    <title>ORDALIE</title>
    <link rel="stylesheet" href="/css/main.css?v=20260226-1">
    <link rel="stylesheet" href="/css/hud.css?v=20260226-1">
    <link rel="stylesheet" href="/css/hub.css?v=20260228-1">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen">
        <div class="loading-content">
            <h1 class="game-title">ORDALIE</h1>
            <div class="loading-bar-container">
                <div class="loading-bar" id="loading-bar"></div>
            </div>
            <p class="loading-text" id="loading-text">Preparing the Dark World...</p>
            <p class="loading-tip">Tip: Manage your stamina wisely in combat</p>
        </div>
    </div>

    <!-- Start Screen -->
    <div id="start-screen" style="display: none;">
        <div class="start-content">
            <h1 class="game-title">ORDALIE</h1>
            <p class="subtitle">Face the Trial</p>
            <button id="continue-button" class="game-button" style="display: none;">CONTINUE RUN</button>
            <button id="start-button" class="game-button">START NEW GAME</button>
            <!-- Account / Recovery Code -->
            <div id="account-section" class="account-section">
                <!-- No account yet -->
                <div id="account-none">
                    <button id="create-account-btn" class="game-button account-btn">CREATE ACCOUNT</button>
                    <button id="restore-account-btn" class="game-button account-btn">RESTORE ACCOUNT</button>
                </div>
                <!-- Account exists -->
                <div id="account-info" style="display:none;">
                    <p class="account-name">Account: <span id="account-name-text"></span></p>
                    <button id="show-code-btn" class="game-button account-btn">SHOW RECOVERY CODE</button>
                </div>
                <!-- Create account form -->
                <div id="account-create-form" style="display:none;">
                    <p class="account-label">Choose a name for your account:</p>
                    <input type="text" id="account-name-input" class="account-input" maxlength="20" placeholder="Your name...">
                    <div class="account-form-buttons">
                        <button id="account-create-confirm" class="game-button account-btn">CONFIRM</button>
                        <button id="account-create-cancel" class="game-button account-btn">CANCEL</button>
                    </div>
                </div>
                <!-- Restore account form -->
                <div id="account-restore-form" style="display:none;">
                    <p class="account-label">Enter your recovery code:</p>
                    <input type="text" id="account-code-input" class="account-input" placeholder="XXXX-XXXX-XXXX-...">
                    <p id="account-restore-error" class="account-error" style="display:none;"></p>
                    <div class="account-form-buttons">
                        <button id="account-restore-confirm" class="game-button account-btn">RESTORE</button>
                        <button id="account-restore-cancel" class="game-button account-btn">CANCEL</button>
                    </div>
                </div>
                <!-- Show recovery code -->
                <div id="account-code-display" style="display:none;">
                    <p class="account-label">Your recovery code (save it!):</p>
                    <div class="recovery-code-box" id="recovery-code-text"></div>
                    <button id="copy-code-btn" class="game-button account-btn">COPY CODE</button>
                    <button id="close-code-btn" class="game-button account-btn">CLOSE</button>
                </div>
            </div>

            <div class="controls-hint">
                <p>AZERTY: Z - Avancer | Q - Gauche | D - Droite | Souris - Regarder</p>
                <p>Espace - Saut | R - Dash | Clic gauche - Attaque | Clic droit - Attaque chargée</p>
                <p>Q - Ability 1 | E - Finisher | X - Ability 3 | C - Shield | & - Potion | F - Ultimate</p>
            </div>
        </div>
    </div>

    <!-- Class Selection Screen -->
    <div id="class-select-screen" style="display: none;">
        <div class="class-select-content">
            <h1 class="game-title class-select-title">CHOOSE YOUR PATH</h1>

            <!-- Step 1: Class selection -->
            <div id="class-step" class="selection-step">
                <p class="step-label">SELECT A CLASS</p>
                <div class="class-cards" id="class-cards"></div>
            </div>

            <!-- Step 2: Kit/Specialization selection -->
            <div id="kit-step" class="selection-step" style="display: none;">
                <p class="step-label">SELECT A SPECIALIZATION</p>
                <div class="kit-cards" id="kit-cards"></div>
                <button class="game-button back-button" id="kit-back-btn">BACK</button>
            </div>

            <!-- Step 3: Confirm -->
            <div id="confirm-step" class="selection-step" style="display: none;">
                <div class="kit-preview" id="kit-preview"></div>
                <div class="kit-preview-stats" id="kit-preview-stats"></div>
                <div class="kit-preview-abilities" id="kit-preview-abilities"></div>
                <div class="confirm-buttons">
                    <button class="game-button back-button" id="confirm-back-btn">BACK</button>
                    <button class="game-button confirm-button" id="confirm-btn">ENTER THE HUB</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ═══ HUB — Main Navigation ═══ -->
    <div id="hub-screen" class="hub-screen" style="display: none;">
        <button class="hub-back-btn" id="hub-back-btn">MENU</button>
        <div class="hub-header">
            <div class="hub-title">ORDALIE</div>
            <div class="hub-subtitle">CHOOSE YOUR PATH</div>
            <div class="hub-souls" id="hub-souls">0 SOULS</div>
        </div>
        <div class="hub-nav">
            <div class="hub-card" id="hub-tower">
                <span class="hub-card-icon">\u{1F3F0}</span>
                <div class="hub-card-title">BOSS TOWER</div>
                <div class="hub-card-desc">Endless ascent. Each floor a deadlier guardian. How far can you climb?</div>
            </div>
            <div class="hub-card disabled" id="hub-pvx">
                <span class="hub-card-icon">\u2694</span>
                <div class="hub-card-title">PVX ARENA</div>
                <div class="hub-card-desc">Prove your worth against other warriors in the crucible.</div>
                <div class="hub-card-badge">COMING SOON</div>
            </div>
            <div class="hub-card" id="hub-boutique">
                <span class="hub-card-icon">\u{1F4B0}</span>
                <div class="hub-card-title">BOUTIQUE</div>
                <div class="hub-card-desc">Spend souls on weapons, armor, and consumables to grow stronger.</div>
            </div>
            <div class="hub-card" id="hub-character">
                <span class="hub-card-icon">\u{1F464}</span>
                <div class="hub-card-title">CHARACTER</div>
                <div class="hub-card-desc">Equip gear, unlock talents, and forge your build.</div>
            </div>
        </div>
    </div>

    <!-- ═══ BOUTIQUE — Shop ═══ -->
    <div id="boutique-screen" class="hub-screen" style="display: none;">
        <button class="hub-back-btn" id="boutique-back-btn">BACK</button>
        <div class="hub-header">
            <div class="hub-title">BOUTIQUE</div>
            <div class="hub-souls" id="boutique-souls">0 SOULS</div>
        </div>
        <div class="shop-tabs" id="shop-tabs">
            <button class="shop-tab active" data-slot="weapon">WEAPONS</button>
            <button class="shop-tab" data-slot="helmet">HELMETS</button>
            <button class="shop-tab" data-slot="chest">CHEST</button>
            <button class="shop-tab" data-slot="boots">BOOTS</button>
            <button class="shop-tab" data-slot="consumable">CONSUMABLES</button>
        </div>
        <div class="shop-grid" id="shop-grid"></div>
    </div>

    <!-- ═══ CHARACTER — Gear + Talent Tree ═══ -->
    <div id="character-screen" class="hub-screen" style="display: none;">
        <button class="hub-back-btn" id="char-back-btn">BACK</button>
        <div class="hub-header">
            <div class="hub-title">CHARACTER</div>
            <div class="hub-souls" id="char-souls">0 SOULS</div>
        </div>
        <div class="char-stat-summary" id="char-stat-summary"></div>
        <div class="char-layout">
            <!-- Gear Panel -->
            <div class="gear-panel">
                <div class="gear-panel-title">EQUIPMENT</div>
                <div class="gear-slots" id="gear-slots"></div>
            </div>
            <!-- Talent Tree -->
            <div class="talent-panel">
                <div class="talent-panel-header">
                    <div class="talent-panel-title">TALENTS</div>
                    <div class="talent-points-display" id="talent-points">0 POINTS</div>
                </div>
                <div class="talent-branches" id="talent-branches"></div>
            </div>
        </div>
        <!-- Gear picker modal -->
        <div class="gear-picker-overlay" id="gear-picker-overlay">
            <div class="gear-picker">
                <div class="gear-picker-title" id="gear-picker-title">SELECT ITEM</div>
                <div id="gear-picker-items"></div>
            </div>
        </div>
    </div>

    <!-- Game Canvas Container -->
    <div id="game-container">
        <canvas id="game-canvas"></canvas>
    </div>

    <!-- HUD Overlay -->
    <div id="hud" style="display: none;">
        <!-- Reticule (crosshair) -->
        <div id="reticule" class="reticule" aria-hidden="true">
            <span class="reticule-dot"></span>
            <span class="reticule-line reticule-n"></span>
            <span class="reticule-line reticule-s"></span>
            <span class="reticule-line reticule-e"></span>
            <span class="reticule-line reticule-w"></span>
        </div>
        <!-- Health Bar -->
        <div class="stat-bar health-bar">
            <div class="bar-fill" id="health-fill"></div>
            <span class="bar-text" id="health-text">100/100</span>
        </div>
        <!-- No Blood Essence feedback (shown when E pressed with 0 charges) -->
        <div id="no-blood-essence" class="no-blood-essence" style="display: none;">No Blood Essence</div>
        
        <!-- Stamina Bar -->
        <div class="stat-bar stamina-bar">
            <div class="bar-fill" id="stamina-fill"></div>
            <span class="bar-text" id="stamina-text">100/100</span>
        </div>
        
        <!-- Super Dash Bar (É) -->
        <div id="superdash-bar" class="superdash-bar">
            <div class="superdash-bar-bg">
                <div class="superdash-bar-fill" id="superdash-fill"></div>
            </div>
            <span class="superdash-bar-label">SUPER DASH (É)</span>
        </div>

        <!-- Ultimate Bar (F when full) -->
        <div id="ultimate-bar" class="ultimate-bar">
            <div class="ultimate-bar-bg">
                <div class="ultimate-bar-fill" id="ultimate-fill"></div>
            </div>
            <span class="ultimate-bar-label">ULTIMATE (F)</span>
        </div>
        
        <!-- Charge Bar (visible when charging) -->
        <div id="charge-bar" class="charge-bar" style="display: none;">
            <div class="charge-bar-bg">
                <div class="charge-bar-fill" id="charge-fill"></div>
                <div class="charge-bar-ready" id="charge-ready"></div>
            </div>
            <span class="charge-bar-label" id="charge-label">CHARGE</span>
        </div>
        
        <!-- Ability Cooldowns -->
        <div id="ability-hud" aria-label="Ability cooldowns">
            <div class="ability-box" id="ability-eruption" data-ready="true">
                <div class="ability-key">Q</div>
                <div class="ability-name">Eruption</div>
                <div class="ability-timer" id="ability-eruption-timer">Ready</div>
            </div>
            <div class="ability-box" id="ability-nova" data-ready="true">
                <div class="ability-key">X</div>
                <div class="ability-name">Nova</div>
                <div class="ability-timer" id="ability-nova-timer">Ready</div>
            </div>
            <div class="ability-box" id="ability-shield" data-ready="true">
                <div class="ability-key">C</div>
                <div class="ability-name">Shield</div>
                <div class="ability-timer" id="ability-shield-timer">Ready</div>
            </div>
            <div class="ability-box" id="ability-potion" data-ready="true">
                <div class="ability-key">&</div>
                <div class="ability-name">Potion</div>
                <div class="ability-timer" id="ability-potion-timer">Ready</div>
            </div>
        </div>
        
        <!-- Damage Numbers Container -->
        <div id="damage-numbers"></div>
        
        <!-- FPS Counter -->
        <div id="fps-counter">FPS: 60</div>
        
        <!-- Boss Health Bar (hidden by default) -->
        <div id="boss-health" style="display: none;">
            <span class="boss-name" id="boss-name">DARK KNIGHT</span>
            <div class="boss-bar">
                <div class="bar-fill" id="boss-health-fill"></div>
            </div>
        </div>
    </div>

    <!-- Pause Menu -->
    <div id="pause-menu" style="display: none;">
        <div class="pause-content">
            <h2>PAUSED</h2>
            <button class="game-button" id="resume-button">Resume</button>
            <button class="game-button" id="settings-button">Settings</button>
            <button class="game-button" id="quit-button">Quit to Menu</button>
        </div>
    </div>

    <!-- Settings Panel -->
    <div id="settings-panel" style="display: none;">
        <div class="settings-content">
            <h2>SETTINGS</h2>
            <div class="setting-row">
                <label>Shadow Quality</label>
                <select id="shadow-quality">
                    <option value="low" selected>Low</option>
                    <option value="medium">Medium</option>
                    <option value="high">High</option>
                </select>
            </div>
            <div class="setting-row">
                <label>Particle Count</label>
                <select id="particle-quality">
                    <option value="low" selected>Low</option>
                    <option value="medium">Medium</option>
                    <option value="high">High</option>
                </select>
            </div>
            <div class="setting-row">
                <label>Post Processing (Bloom)</label>
                <input type="checkbox" id="post-processing">
            </div>
            <div class="setting-row">
                <label>Motion Smoothing</label>
                <input type="checkbox" id="motion-smoothing">
            </div>
            <div class="setting-row">
                <label>Mouse Sensitivity</label>
                <input type="range" id="mouse-sensitivity" min="1" max="10" value="5">
            </div>
            <button class="game-button" id="settings-back">Back</button>
        </div>
    </div>

    <!-- Tower Progression Screen (shown after boss defeat) -->
    <div id="tower-screen" style="display: none;">
        <div class="tower-content">
            <h1 class="tower-title">TOWER ASCENT</h1>
            <p class="tower-subtitle" id="tower-subtitle">Floor Conquered</p>
            <div class="tower-shaft" id="tower-shaft">
                <!-- Boss floors are built dynamically by JS -->
            </div>
            <button class="game-button tower-continue-btn" id="tower-continue-btn">CONTINUE ASCENT</button>
            <button class="game-button tower-quit-btn account-btn" id="tower-quit-btn">QUIT TO MENU</button>
        </div>
    </div>

    <!-- Death Screen -->
    <div id="death-screen" style="display: none;">
        <h1 class="death-text">YOU DIED</h1>
    </div>

    <!-- Import Map for ES Modules -->
    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
        }
    }
    </script>
    
    <script type="module" src="/js/main.js?v=20260226-2"></script>
</body>
</html>

